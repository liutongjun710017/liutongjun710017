<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>èº«ä»½è®¤è¯ç³»ç»Ÿ - è”é‚¦æ²™å‹’è°ƒæŸ¥å±€</title>
    <style>
        *{margin:0;padding:0;box-sizing:border-box}
        body{font-family:'Microsoft YaHei',sans-serif;background:linear-gradient(135deg,#1a1a2e,#16213e);color:white;min-height:100vh;display:flex;justify-content:center;align-items:center;padding:20px}
        .container{background:rgba(255,255,255,0.1);backdrop-filter:blur(10px);border-radius:15px;padding:30px;width:100%;max-width:500px;box-shadow:0 8px 32px rgba(0,0,0,0.3);border:1px solid rgba(255,255,255,0.2)}
        .header{text-align:center;margin-bottom:30px}
        .header h1{font-size:24px;margin-bottom:8px;background:linear-gradient(45deg,#00b4db,#0083b0);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
        .nfc-section{text-align:center;margin-bottom:20px;padding:15px;background:rgba(255,255,255,0.05);border-radius:10px;border:1px solid rgba(255,255,255,0.1)}
        .nfc-button{background:linear-gradient(45deg,#00b4db,#0083b0);color:white;border:none;padding:12px 24px;border-radius:25px;font-size:16px;cursor:pointer;margin:10px 5px;transition:transform 0.2s}
        .nfc-button:hover{transform:scale(1.05)}
        .nfc-button:disabled{background:#666;cursor:not-allowed}
        .manual-test{margin-top:15px;padding:15px;background:rgba(255,255,255,0.03);border-radius:8px}
        .manual-input{width:100%;padding:10px;border:1px solid rgba(255,255,255,0.2);border-radius:5px;background:rgba(255,255,255,0.1);color:white;margin:10px 0}
        .nfc-status{font-size:14px;color:#ffa726;margin-top:10px;min-height:20px}
        .status-item{display:flex;justify-content:space-between;align-items:center;padding:15px 0;border-bottom:1px solid rgba(255,255,255,0.1);font-size:16px}
        .label{font-weight:bold;color:#cccccc}
        .value{font-weight:bold}
        .checking{color:#ffa726}
        .checking::after{content:'...';animation:dots 1.5s infinite}
        .verified{color:#4caf50;position:relative}
        .verified::after{content:' âœ“';color:#4caf50;font-weight:bold}
        .unauthorized{color:#f44336;position:relative}
        .unauthorized::after{content:' âœ—';color:#f44336;font-weight:bold}
        .loading-bar{width:100%;height:4px;background:rgba(255,255,255,0.1);border-radius:2px;margin:20px 0;overflow:hidden}
        .loading-progress{height:100%;background:linear-gradient(90deg,#00b4db,#0083b0);border-radius:2px;width:0%;transition:width 0.5s ease}
        @keyframes dots{0%,20%{content:'.'}40%{content:'..'}60%,100%{content:'...'}}
        .footer{text-align:center;margin-top:20px;font-size:12px;color:#888}
        .card-info{background:rgba(255,255,255,0.05);padding:10px;border-radius:8px;margin-top:10px;font-size:12px;color:#ccc}
        .card-id{color:#00b4db;font-family:monospace;background:rgba(0,180,219,0.1);padding:2px 6px;border-radius:4px}
        .test-buttons{display:flex;gap:10px;justify-content:center;margin:10px 0}
        .test-button{background:rgba(255,255,255,0.1);border:1px solid rgba(255,255,255,0.2);color:white;padding:8px 16px;border-radius:5px;cursor:pointer;font-size:12px}
        .test-button:hover{background:rgba(255,255,255,0.2)}
        .error-message{color:#ff6b6b;font-size:12px;margin-top:5px}
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ” èº«ä»½è®¤è¯ç³»ç»Ÿ</h1>
            <p>è”é‚¦æ²™å‹’è°ƒæŸ¥å±€ - å®‰å…¨éªŒè¯</p>
        </div>
        
        <div class="nfc-section">
            <div>è¯·å°†NFCå¡ç‰‡é è¿‘è®¾å¤‡</div>
            <button class="nfc-button" onclick="startNFCScan()" id="nfcButton">å¼€å§‹NFCæ‰«æ</button>
            <div class="nfc-status" id="nfcStatus">ç­‰å¾…æ‰«æ...</div>
            <div id="nfcError" class="error-message"></div>
            
            <div class="manual-test">
                <div>æ‰‹åŠ¨æµ‹è¯•ï¼š</div>
                <input type="text" class="manual-input" id="manualCardId" placeholder="è¾“å…¥å¡ç‰‡IDï¼Œå¦‚ï¼šse 710017">
                <button class="nfc-button" onclick="manualTest()">æ‰‹åŠ¨éªŒè¯</button>
                
                <div class="test-buttons">
                    <button class="test-button" onclick="testCard('se 710017')">æµ‹è¯•Senseiå¡</button>
                    <button class="test-button" onclick="testCard('unknown')">æµ‹è¯•æœªçŸ¥å¡</button>
                    <button class="test-button" onclick="testCard('')">æµ‹è¯•ç©ºç™½å¡</button>
                </div>
            </div>
            
            <div class="card-info" id="cardInfo"></div>
        </div>
        
        <div class="loading-bar">
            <div class="loading-progress" id="loadingProgress"></div>
        </div>
        
        <div id="statusDisplay">
            <div class="status-item">
                <span class="label">CAR IDï¼š</span>
                <span class="value checking" id="cardIdStatus">ç­‰å¾…è¯»å–</span>
            </div>
                        <div class="status-item">
                <span class="label">å§“åï¼š</span>
                <span class="value checking" id="nameStatus">ç­‰å¾…NFCéªŒè¯</span>
            </div>
            <div class="status-item">
                <span class="label">éš¶å±ï¼š</span>
                <span class="value checking" id="affiliationStatus">ç­‰å¾…NFCéªŒè¯</span>
            </div>
            <div class="status-item">
                <span class="label">æƒé™ç­‰çº§ï¼š</span>
                <span class="value checking" id="levelStatus">ç­‰å¾…NFCéªŒè¯</span>
            </div>
            <div class="status-item">
                <span class="label">åŒºåŸŸè®¤è¯ï¼š</span>
                <span class="value checking" id="areaStatus">ç­‰å¾…NFCéªŒè¯</span>
            </div>
        </div>
        
        <div class="footer">
            <p>æœ€åæ›´æ–°: <span id="timestamp"></span></p>
        </div>
    </div>

    <script>
        document.getElementById('timestamp').textContent = new Date().toLocaleString('zh-CN');
        const nfcCards = {"se 710017":{name:'Sensei',affiliation:'è”é‚¦æ²™å‹’è°ƒæŸ¥å±€',level:'WTR',area:'é˜¿æ‹œå¤šæ–¯',type:'å®˜æ–¹è®¤è¯'}};
        const loadingProgress = document.getElementById('loadingProgress');
        let ndefReader = null;

        async function startNFCScan() {
            const nfcStatus = document.getElementById('nfcStatus');
            const nfcButton = document.getElementById('nfcButton');
            const nfcError = document.getElementById('nfcError');
            
            if (!('NDEFReader' in window)) {
                nfcStatus.textContent = 'âŒ æ­¤æµè§ˆå™¨ä¸æ”¯æŒWeb NFC API';
                nfcError.textContent = 'è¯·ä½¿ç”¨ Chrome for Android æˆ–å…¶ä»–æ”¯æŒWeb NFCçš„æµè§ˆå™¨';
                return;
            }

            try {
                nfcButton.disabled = true;
                nfcStatus.textContent = 'è¯·å°†å¡ç‰‡é è¿‘è®¾å¤‡...';
                nfcError.textContent = '';
                ndefReader = new NDEFReader();
                await ndefReader.scan();
                nfcStatus.textContent = 'æ‰«æä¸­...å°†å¡ç‰‡é è¿‘è®¾å¤‡';
                
                ndefReader.onreading = event => {
                    const decoder = new TextDecoder();
                    let cardId = '';
                    for (const record of event.message.records) {
                        if (record.recordType === "text") {
                            cardId = decoder.decode(record.data);
                            break;
                        }
                    }
                    nfcStatus.textContent = `è¯»å–åˆ°å¡ç‰‡æ•°æ®`;
                    processNFCCard(cardId);
                };

                ndefReader.onreadingerror = event => {
                    nfcStatus.textContent = 'âŒ è¯»å–å¡ç‰‡å¤±è´¥';
                    nfcError.textContent = 'è¯·é‡æ–°å°è¯•é è¿‘å¡ç‰‡';
                    nfcButton.disabled = false;
                };

            } catch (error) {
                nfcStatus.textContent = 'âŒ NFCæ‰«æå¯åŠ¨å¤±è´¥';
                nfcError.textContent = error.message;
                nfcButton.disabled = false;
            }
        }

        function stopNFCScan() {
            if (ndefReader) {
                ndefReader.onreading = null;
                ndefReader.onreadingerror = null;
            }
            document.getElementById('nfcButton').disabled = false;
        }

        function manualTest() {
            const cardId = document.getElementById('manualCardId').value.trim();
            if (!cardId) { alert('è¯·è¾“å…¥å¡ç‰‡ID'); return; }
            stopNFCScan();
            processNFCCard(cardId);
        }

        function testCard(cardId) {
            document.getElementById('manualCardId').value = cardId;
            stopNFCScan();
            processNFCCard(cardId);
        }

        function processNFCCard(cardId) {
            const nfcStatus = document.getElementById('nfcStatus');
            const cardInfo = document.getElementById('cardInfo');
            resetAllStatus();
            document.getElementById('nfcButton').disabled = false;
            loadingProgress.style.width = '25%';

            if (!cardId || cardId.trim() === '') {
                nfcStatus.textContent = 'âŒ è¯»å–åˆ°ç©ºç™½æ ‡ç­¾';
                nfcStatus.style.color = '#f44336';
                cardInfo.innerHTML = 'æ ‡ç­¾ä¸­æ²¡æœ‰å­˜å‚¨æ–‡æœ¬æ•°æ®';
                cardInfo.style.color = '#f44336';
                document.getElementById('cardIdStatus').textContent = 'ç©ºç™½æ ‡ç­¾';
                document.getElementById('cardIdStatus').className = 'value unauthorized';
                showUnauthorizedStatus();
                return;
            }

            document.getElementById('cardIdStatus').innerHTML = `<span class="card-id">${cardId}</span>`;
            document.getElementById('cardIdStatus').className = 'value verified';

            if (nfcCards[cardId]) {
                const cardData = nfcCards[cardId];
                nfcStatus.textContent = 'âœ… å¡ç‰‡éªŒè¯æˆåŠŸ';
                nfcStatus.style.color = '#4caf50';
                cardInfo.innerHTML = `å¡ç‰‡ç±»å‹: ${cardData.type}`;
                cardInfo.style.color = '#4caf50';

                setTimeout(() => {
                    document.getElementById('nameStatus').textContent = cardData.name;
                    document.getElementById('nameStatus').className = 'value verified';
                    loadingProgress.style.width = '50%';
                }, 500);

                setTimeout(() => {
                    document.getElementById('affiliationStatus').textContent = cardData.affiliation;
                    document.getElementById('affiliationStatus').className = 'value verified';
                    loadingProgress.style.width = '75%';
                }, 1000);

                setTimeout(() => {
                    document.getElementById('levelStatus').textContent = cardData.level;
                    document.getElementById('levelStatus').className = 'value verified';
                    document.getElementById('areaStatus').textContent = cardData.area;
                    document.getElementById('areaStatus').className = 'value verified';
                    loadingProgress.style.width = '100%';
                }, 1500);

            } else {
                nfcStatus.textContent = 'âŒ æœªçŸ¥å¡ç‰‡';
                nfcStatus.style.color = '#f44336';
                cardInfo.innerHTML = `æœªæˆæƒçš„å¡ç‰‡ID: <span class="card-id">${cardId}</span>`;
                cardInfo.style.color = '#f44336';
                showUnauthorizedStatus();
            }
        }

        function showUnauthorizedStatus() {
            setTimeout(() => {
                document.getElementById('nameStatus').textContent = 'æœªçŸ¥ç”¨æˆ·';
                document.getElementById('nameStatus').className = 'value unauthorized';
                document.getElementById('affiliationStatus').textContent = 'æœªæˆæƒ';
                document.getElementById('affiliationStatus').className = 'value unauthorized';
                document.getElementById('levelStatus').textContent = 'N/A';
                document.getElementById('levelStatus').className = 'value unauthorized';
                document.getElementById('areaStatus').textContent = 'è®¿é—®è¢«æ‹’ç»';
                document.getElementById('areaStatus').className = 'value unauthorized';
                loadingProgress.style.width = '100%';
            }, 1000);
        }

        function resetAllStatus() {
            document.getElementById('cardIdStatus').textContent = 'ç­‰å¾…è¯»å–';
            document.getElementById('cardIdStatus').className = 'value checking';
            document.getElementById('nameStatus').textContent = 'ç­‰å¾…NFCéªŒè¯';
            document.getElementById('nameStatus').className = 'value checking';
            document.getElementById('affiliationStatus').textContent = 'ç­‰å¾…NFCéªŒè¯';
            document.getElementById('affiliationStatus').className = 'value checking';
            document.getElementById('levelStatus').textContent = 'ç­‰å¾…NFCéªŒè¯';
            document.getElementById('levelStatus').className = 'value checking';
            document.getElementById('areaStatus').textContent = 'ç­‰å¾…NFCéªŒè¯';
            document.getElementById('areaStatus').className = 'value checking';
            loadingProgress.style.width = '0%';
        }
    </script>
</body>
</html>
